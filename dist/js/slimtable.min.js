/*!
 * slimtable ( http://slimtable.mcfish.org/ )
 * 
 * Licensed under MIT license.
 *
 * @version 1.2.2
 * @author Pekka Harjamäki
 */
!function(a){a.fn.slimtable=function(b){function c(){return w.length>0&&u.length!=w[0].length?(console.log("Slimtable: Different number of columns in header and data!"),!1):!0}function d(b){var c,d,e,f,g=document.createElement("select");for(c=document.createElement("div"),a(c).addClass("slimtable-paging-div"),f=0;f<t.ipp_list.length;f++)e=document.createElement("option"),e.value=t.ipp_list[f],e.text=t.ipp_list[f],e.value==t.itemsPerPage&&(e.selected=!0),a(g).append(e);a(g).on("change",k).addClass("slimtable-paging-select"),d=document.createElement("div"),a(d).addClass("slimtable-paging-btnsdiv"),a(c).append(d),o=d,d=document.createElement("div"),a(d).addClass("slimtable-paging-seldiv"),a(d).append(g),a(d).append(t.text1),a(c).append(d),d=document.createElement("div"),a(d).addClass("slimtable-container-div"),a(d).append(c),b.before(d),b.insertBefore(c)}function e(){m.find("th").each(function(b){if(a(this).attr("unselectable","on"),u[b]&&u[b].sortable){var c=document.createElement("span");a(c).attr("unselectable","on").addClass("slimtable-sprites"),"asc"==u[b].sordir?a(c).addClass("slimtable-sortasc"):"desc"==u[b].sordir?a(c).addClass("slimtable-sortdesc"):a(c).addClass("slimtable-sortboth"),a(this).prepend(c).css({cursor:"pointer"}).on("click",l)}else a(this).addClass("slimtable-unsortable")})}function f(){var b,c,d=m.find("th");for(u=new Array,b=0;b<d.length;b++){var e=!0,f=!1,i=-1,j=[];for(c=0;c<t.colSettings.length;c++)if(t.colSettings[c].colNumber==b){0==t.colSettings[c].enableSort&&(e=!1),1==t.colSettings[c].stripHtml&&(f=!0),t.colSettings[c].rowType>=0&&(i=t.colSettings[c].rowType),t.colSettings[c].addClasses&&t.colSettings[c].addClasses.length>0&&(j=t.colSettings[c].addClasses);break}u[b]={sortable:e,classes:j,strip_html:f,sortdir:"asc",rowtype:i}}t.dataUrl&&t.dataUrl.length>2?(r=!0,a.ajax({url:t.dataUrl,dataType:"json"}).done(function(a){w=a,r=!1,h()}).fail(function(a,b){console.log("Slimtable: Ajax error: "+b)})):t.tableData&&t.tableData.length>=0?w=t.tableData:n.find("tr").each(function(){var b=new Array;a(this).find("td").each(function(){b.push(a(this).html())}),w.push(b)}),g()}function g(){var b,c,d,e,f,g=m.find("th");for(b=0;b<g.length;b++)if(-1==u[b].rowtype){for(f=[0,0,0,0,0],c=0;c<w.length;c++)e=w[c][b],e=[e,e],u[b].strip_html&&(e[0]=a(s).html(data).text()),e[0]=a.trim(e[0]),e[0]=e[0].toLowerCase(),w[c][b]={clean:e[0],orig:e[1]},f[i(e[0])]++;for(u[b].rowtype=a.inArray(Math.max.apply(this,f),f),c=0;c<w.length;c++)0==u[b].rowtype&&(w[c][b].clean=new String(w[c][b].clean)),(2==u[b].rowtype||3==u[b].rowtype)&&(w[c][b].clean=parseFloat(w[c][b].clean.replace(",","."))),4==u[b].rowtype&&(d=w[c][b].clean.split(/[.\/-]/),w[c][b].clean=new Date(d[2],d[1],d[0]))}}function h(){var b,c,d,e,f,g,h=parseInt(p)+parseInt(q);for(n.empty(),h=h>w.length?w.length:h,d=Math.ceil(w.length/q),e=p;h>e;e++){for(b=document.createElement("tr"),f=0;f<w[e].length;f++){for(c=document.createElement("td"),a(c).html(w[e][f].orig),g=0;g<u[f].classes.length;g++)a(c).addClass(u[f].classes[g]);a(b).append(c)}n.append(b)}for(a(o).empty(),e=0;d>e;e++)b=document.createElement("div"),a(b).addClass("slimtable-page-btn").on("click",j).text(e+1),e*q==p&&a(b).addClass("active"),a(o).append(b)}function i(a){var b=/[^0-9]/g,c=/^[0-9]+([\.,][0-9]+)?$/,d=/^([0-9]+([\.,][0-9]+)?)\s*[%$€£e]?$/,e=/^[0-9]{1,2}[.-\/][0-9]{1,2}[.-\/][0-9]{4}$/;return b.test(a)?c.test(a)?2:d.test(a)?3:e.test(a)?4:0:1}function j(b){var c=parseInt(a(this).text())-1,d=Math.ceil(w.length/q);0>c||c>=d||(p=c*q,h())}function k(a){this.value;q=this.value,p=0,h()}function l(b){var c,d,e,f=a(this).index(),g=a.inArray(f,v);for(b.preventDefault(),t.sortStartCB&&"function"==typeof t.sortStartCB&&t.sortStartCB.call(this),b.shiftKey?0>g?(v.push(f),u[f].sortdir="asc"):"asc"==u[f].sortdir?u[f].sortdir="desc":u[f].sortdir="asc":(v=[f],0>g?u[f].sortdir="asc":"asc"==u[f].sortdir?u[f].sortdir="desc":u[f].sortdir="asc"),e=0;e<u.length;e++)u[e]&&u[e].sortable&&(c=m.find("th:nth-child("+(e+1)+")"),d=c.find("span"),a.inArray(e,v)<0?(c.removeClass("slimtable-activeth"),d.removeClass("slimtable-sortasc"),d.removeClass("slimtable-sortdesc"),d.addClass("slimtable-sortboth")):(d.removeClass("slimtable-sortboth"),d.removeClass("slimtable-sort"+("asc"==u[e].sortdir?"desc":"asc")),d.addClass("slimtable-sort"+u[e].sortdir),c.addClass("slimtable-activeth")));v.length>0&&w.sort(function(a,b){var c,d,e,f,g=v.length;for(f=0;g>f;f++)if(c=v[f],"desc"==u[c].sortdir?(d=b[c].clean,e=a[c].clean):(d=a[c].clean,e=b[c].clean),!(d==e&&g-1>f))return 0==u[c].rowtype?d.localeCompare(e):d-e}),h(),t.sortEndCB&&"function"==typeof t.sortEndCB&&t.sortEndCB.call(this)}var m,n,o,p,q,r,s,t=a.extend({tableData:null,dataUrl:null,itemsPerPage:10,ipp_list:[5,10,20],colSettings:[],text1:"items/page",text2:"Loading...",sortStartCB:null,sortEndCB:null},b),u=[],v=[],w=[];return this.each(function(){return p=0,r=!1,q=t.itemsPerPage,s=document.createElement("div"),m=a(this).find("thead"),n=a(this).find("tbody"),0==m.length||0==n.length?void console.log("Slimtable: thead/tbody missing from table!"):(f(),void((0!=r||c())&&(a(this).addClass("slimtable"),e(),d(a(this)),h())))})}}(jQuery);