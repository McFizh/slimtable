/*!
 * slimtable ( https://slimtable.mcfish.org/ )
 *
 * Licensed under MIT license.
 *
 * @version 2.0.2
 * @author Pekka Harjamäki
 */
(o=>{let a={init:function(t,s){this.settings=o.extend({tableData:null,dataUrl:null,itemsPerPage:10,ippList:[5,10,20],pagingStart:0,keepAttrs:[],sortList:[],colSettings:[],text1:"items/page",text2:"Loading...",sortStartCB:null,sortEndCB:null},s),this.state={showLoader:!1,cleanerDiv:o("<div></div>"),colSettings:[],tblData:[],sortList:0<this.settings.sortList.length?this.settings.sortList:[],pagingStart:parseInt(this.settings.pagingStart),itemsPerPage:parseInt(this.settings.itemsPerPage),tableHeads:t.find("thead tr th"),tableBody:t.find("tbody")},0===this.state.tableHeads.length||0===this.state.tableBody.length?this.showError("thead/tbody missing from table!"):(this.parseColSettings(),this.readTable(),!1!==this.state.showLoader||this.sanityCheck()?(t.addClass("slimtable"),this.addSortIcons(),this.addPaging(t),this.doSorting()):this.showError("Different number of columns in header and data!"))},parseColSettings:function(){for(let t=0;t<this.state.tableHeads.length;t++){this.state.colSettings[t]={enableSort:!0,classes:[],stripHtml:!1,sortDir:"asc",rowType:-1,colNumber:t};for(var s of this.settings.colSettings)if(s.colNumber===t){!1===s.enableSort&&(this.state.colSettings[t].enableSort=!1),!0===s.stripHtml&&(this.state.colSettings[t].stripHtml=!0),"asc"!==s.sortDir&&"desc"!==s.sortDir||(this.state.colSettings[t].sortDir=s.sortDir),0<=s.rowType&&(this.state.colSettings[t].rowType=s.rowType),s.addClasses&&0<s.addClasses.length&&(this.state.colSettings[t].classes=s.addClasses);break}}},returnRowType:function(t){return 0===t.length?-1:/[^0-9]/g.test(t)?/^[0-9]+([.,][0-9]+)?$/.test(t)?2:/^([0-9]+([.,][0-9]+)?)\s*[%$€£e]?$/.test(t)?3:/^[0-9]{1,2}[.-/][0-9]{1,2}[.-/][0-9]{4}$/.test(t)?4:0:1},readTable:function(){let t,s,e,a,i,l;if(this.settings.dataUrl&&2<this.settings.dataUrl.length)this.showLoader=!0,o.ajax({url:this.settings.dataUrl,dataType:"json"}).done(function(t){this.processData(t),this.showLoader=!1,this.createTableBody()}).fail(function(t,s){this.showError("Ajax error: "+s)});else if(this.settings.tableData&&0<=this.settings.tableData.length)this.processData(this.settings.tableData);else{let s=this;this.state.tableBody.find("tr").each(function(){i={data:[],attrs:[]};for(var t of s.settings.keepAttrs)void 0!==(l=o(this).attr(t))&&i.attrs.push({attr:t,value:l});o(this).find("td").each(function(){a={orig:o(this).html(),attrs:[],clean:null},null!=(l=o(this).attr("sort-data"))&&(a.clean=l);for(var t of s.settings.keepAttrs)void 0!==(l=o(this).attr(t))&&a.attrs.push({attr:t,value:l});i.data.push(a)}),s.state.tblData.push(i)})}if(this.sanityCheck())for(t=0;t<this.state.tableHeads.length;t++){if(e=[0,0,0,0,0],-1===this.state.colSettings[t].rowType){for(s=0;s<this.state.tblData.length;s++)null===(a=this.state.tblData[s].data[t]).clean?(a=this.state.colSettings[t].stripHtml?this.state.cleanerDiv.html(a.orig).text():a.orig,a=o.trim(a).toLowerCase(),this.state.tblData[s].data[t].clean=a):a=a.clean,0<(l=this.returnRowType(a))&&e[l]++;this.state.colSettings[t].rowType=o.inArray(Math.max.apply(this,e),e)}for(s=0;s<this.state.tblData.length;s++)l=this.state.colSettings[t].rowType,a=this.state.tblData[s].data[t].clean,0===l&&(this.state.tblData[s].data[t].clean=String(a)),2!==l&&3!==l||(this.state.tblData[s].data[t].clean=parseFloat(a.replace(",","."))),4===l&&(a=a.split(/[./-]/),this.state.tblData[s].data[t].clean=new Date(a[2],a[1],a[0]))}},processData:function(t){let s,e,a;for(this.state.tblData=[],s=0;s<t.length;s++){for(a={data:[],attrs:[]},e=0;e<t[s].length;e++)a.data.push({orig:t[s][e],attrs:[],clean:null});this.state.tblData.push(a)}},createTableHead:function(){let t,s,e;for(t=0;t<this.state.tableHeads.length;t++)this.state.colSettings[t]&&this.state.colSettings[t].enableSort&&(s=o(this.state.tableHeads[t]),e=s.find("span"),o.inArray(t,this.state.sortList)<0?(s.removeClass("slimtable-activeth"),e.removeClass("slimtable-sortasc").removeClass("slimtable-sortdesc").addClass("slimtable-sortboth")):(s.addClass("slimtable-activeth"),e.removeClass("slimtable-sortboth").removeClass("slimtable-sort"+("asc"===this.state.colSettings[t].sortDir?"desc":"asc")).addClass("slimtable-sort"+this.state.colSettings[t].sortDir)))},createTableBody:function(){var t=Math.ceil(this.state.tblData.length/this.state.itemsPerPage),s=this.state.pagingStart+this.state.itemsPerPage;let e,a,i,l,r,n;for(this.state.tableBody.empty(),s=s>this.state.tblData.length?this.state.tblData.length:s,l=this.state.pagingStart;l<s;l++){for(a=o("<tr></tr>"),n=0;n<this.state.tblData[l].attrs.length;n++)o(a).attr(this.state.tblData[l].attrs[n].attr,this.state.tblData[l].attrs[n].value);for(r=0;r<this.state.tblData[l].data.length;r++){for(e=this.state.tblData[l].data[r],i=o("<td></td>").html(e.orig),n=0;n<e.attrs.length;n++)o(i).attr(e.attrs[n].attr,e.attrs[n].value);for(n=0;n<this.state.colSettings[r].classes.length;n++)o(i).addClass(this.state.colSettings[r].classes[n]);o(a).append(i)}this.state.tableBody.append(a)}for(o(this.state.btnContainer).empty(),l=0;l<t;l++)a=document.createElement("div"),o(a).addClass("slimtable-page-btn").on("click",{self:this},this.handlePageChange).text(l+1),l*this.state.itemsPerPage===this.state.pagingStart&&o(a).addClass("active"),o(this.state.btnContainer).append(a)},addSortIcons:function(){let e=this;this.state.tableHeads.each(function(t){o(this).attr("unselectable","on");var s,t=e.state.colSettings[t];t&&t.enableSort?(s=o("<span></span>").attr("unselectable","on").addClass("slimtable-sprites"),"asc"===t.sortDir?s.addClass("slimtable-sortasc"):"desc"===t.sortDir?s.addClass("slimtable-sortdesc"):s.addClass("slimtable-sortboth"),o(this).prepend(s).css({cursor:"pointer"}).on("click",{self:e},e.handleHeaderClick)):o(this).addClass("slimtable-unsortable")})},addPaging:function(t){let s,e,a;a=o("<select></select>").addClass("slimtable-paging-select").on("change",{self:this},this.handleIppChange);for(let t of this.settings.ippList)e=o("<option></option>").val(t).text(t),t===this.settings.itemsPerPage&&e.attr("selected","selected"),o(a).append(e);e=o("<div></div>").addClass("slimtable-paging-btnsdiv"),this.state.btnContainer=e,s=o("<div></div>").addClass("slimtable-paging-div").append(e),e=o("<div></div>").addClass("slimtable-paging-seldiv").append(a).append(this.settings.text1),o(s).append(e),e=o("<div></div>").addClass("slimtable-container-div").append(s),t.before(e),t.insertBefore(s)},doSorting:function(){let o=this;0<this.state.sortList.length&&this.state.tblData.sort(function(t,s){let e,a,i,l;var r=o.state.sortList.length;for(i=0;i<r;i++){var n=o.state.sortList[i];if(a=("desc"===o.state.colSettings[n].sortDir?(e=s.data[n].clean,t):(e=t.data[n].clean,s)).data[n].clean,l=!1,0===o.state.colSettings[n].rowType?0===e.localeCompare(a)&&(l=!0):4===o.state.colSettings[n].rowType?e-a==0&&(l=!0):e===a&&(l=!0),!(l&&i<r-1))return 0===o.state.colSettings[n].rowType?e.localeCompare(a):e-a}}),this.createTableHead(),this.createTableBody()},handleHeaderClick:function(t){var s=t.data.self,e=o(this).index(),a=o.inArray(e,s.state.sortList);t.preventDefault(),s.settings.sortStartCB&&"function"==typeof s.settings.sortStartCB&&s.settings.sortStartCB.call(s),t.shiftKey?a<0?(s.state.sortList.push(e),s.state.colSettings[e].sortDir="asc"):"asc"===s.state.colSettings[e].sortDir?s.state.colSettings[e].sortDir="desc":s.state.colSettings[e].sortDir="asc":(s.state.sortList=[e],!(a<0)&&"asc"===s.state.colSettings[e].sortDir?s.state.colSettings[e].sortDir="desc":s.state.colSettings[e].sortDir="asc"),s.doSorting(),s.settings.sortEndCB&&"function"==typeof s.settings.sortEndCB&&s.settings.sortEndCB.call(s)},handleIppChange:function(t){t=t.data.self;t.state.itemsPerPage=parseInt(this.value),t.state.pagingStart=0,t.createTableBody()},handlePageChange:function(t){var s=parseInt(o(this).text())-1,t=t.data.self,e=Math.ceil(t.state.tblData.length/t.state.itemsPerPage);0<=s&&s<e&&(t.state.pagingStart=s*t.state.itemsPerPage,t.createTableBody())},sanityCheck:function(){return!(0<this.state.tblData.length&&this.state.colSettings.length!==this.state.tblData[0].data.length)},showError:function(t){console.log("Slimtable: "+t)},getState:function(){var t=this.state;return{colSettings:t.colSettings,sortList:t.sortList,pagingStart:t.pagingStart,itemsPerPage:t.itemsPerPage}}};o.fn.slimtable=function(s){let e="plugin_slimtable";var t;return void 0===s||"object"==typeof s?this.each(function(){var t;o.data(this,e)||((t=Object.create(a)).init(o(this),s),o.data(this,e,t))}):"string"==typeof s&&"getState"===s?(t=o(this).data(e))?t.getState():{}:void 0}})(jQuery);