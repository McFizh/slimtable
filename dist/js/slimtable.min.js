/*!
 * slimtable ( http://slimtable.mcfish.org/ )
 * 
 * Licensed under MIT license.
 *
 * @version 1.2.1
 * @author Pekka Harjamäki
 */
!function(a){a.fn.slimtable=function(b){function c(){return x.length>0&&v.length!=x[0].length?(console.log("Slimtable: Different number of columns in header and data!"),!1):!0}function d(b){var c,d,e,f,g=document.createElement("select");for(c=document.createElement("div"),a(c).addClass("slimtable-paging-div"),f=0;f<u.ipp_list.length;f++)e=document.createElement("option"),e.value=u.ipp_list[f],e.text=u.ipp_list[f],e.value==u.itemsPerPage&&(e.selected=!0),a(g).append(e);a(g).on("change",l).addClass("slimtable-paging-select"),d=document.createElement("div"),a(d).addClass("slimtable-paging-btnsdiv"),a(c).append(d),p=d,d=document.createElement("div"),a(d).addClass("slimtable-paging-seldiv"),a(d).append(g),a(d).append(u.text1),a(c).append(d),d=document.createElement("div"),a(d).addClass("slimtable-container-div"),a(d).append(c),b.before(d),b.insertBefore(c)}function e(){n.find("th").each(function(b){if(a(this).attr("unselectable","on"),v[b]&&v[b].sortable){var c=document.createElement("span");a(c).addClass("slimtable-sprites"),a(c).attr("unselectable","on"),"asc"==v[b].sordir?a(c).addClass("slimtable-sortasc"):"desc"==v[b].sordir?a(c).addClass("slimtable-sortdesc"):a(c).addClass("slimtable-sortboth"),a(this).prepend(c).css({cursor:"pointer"}).on("click",m)}})}function f(){var b,c,d=n.find("th");for(v=new Array,b=0;b<d.length;b++){var e=!0,f=!1,i=-1,j=[];for(c=0;c<u.colSettings.length;c++)if(u.colSettings[c].colNumber==b){0==u.colSettings[c].enableSort&&(e=!1),1==u.colSettings[c].stripHtml&&(f=!0),u.colSettings[c].rowType>=0&&(i=u.colSettings[c].rowType),u.colSettings[c].addClasses&&u.colSettings[c].addClasses.length>0&&(j=u.colSettings[c].addClasses);break}v[b]={sortable:e,classes:j,strip_html:f,sortdir:"asc",rowtype:i}}u.dataUrl&&u.dataUrl.length>2?(s=!0,a.ajax({url:u.dataUrl,dataType:"json"}).done(function(a){x=a,s=!1,g(),h()}).fail(function(a,b){console.log("Slimtable: Ajax error: "+b)})):u.tableData&&u.tableData.length>=0?(x=u.tableData,g()):(o.find("tr").each(function(){var b=new Array;a(this).find("td").each(function(){b.push(a(this).html())}),x.push(b)}),g())}function g(){for(var b=n.find("th"),c=0;c<b.length;c++)if(-1==v[c].rowtype){var d,e=[0,0,0,0];for(l2=0;l2<x.length;l2++)d=j(x[l2][c],v[c].strip_html),e[d]++;v[c].rowtype=a.inArray(Math.max.apply(this,e),e)}}function h(){var b,c,d,e,f,g,h=parseInt(q)+parseInt(r);for(o.empty(),h=h>x.length?x.length:h,d=Math.ceil(x.length/r),e=q;h>e;e++){for(b=document.createElement("tr"),f=0;f<x[e].length;f++){for(c=document.createElement("td"),a(c).html(x[e][f]),g=0;g<v[f].classes.length;g++)a(c).addClass(v[f].classes[g]);a(b).append(c)}o.append(b)}for(a(p).empty(),e=0;d>e;e++)b=document.createElement("div"),a(b).addClass("slimtable-page-btn").on("click",k).text(e+1),e*r==q&&a(b).addClass("active"),a(p).append(b)}function i(b){return a(t).html(b).text()}function j(a,b){var c=/[^0-9]/g,d=/[^0-9,\.]/g,e=/^([0-9]+([\.,][0-9]+)?)\s*[%$€£e]?$/;return b&&(a=i(a)),c.test(a)?d.test(a)?e.test(a)?3:0:2:1}function k(b){var c=parseInt(a(this).text())-1,d=Math.ceil(x.length/r);0>c||c>=d||(q=c*r,h())}function l(a){this.value;r=this.value,q=0,h()}function m(b){var c,d,e,f=a(this).index(),g=a.inArray(f,w);for(b.preventDefault(),u.sortStartCB&&"function"==typeof u.sortStartCB&&u.sortStartCB.call(this),b.shiftKey?0>g?(w.push(f),v[f].sortdir="asc"):"asc"==v[f].sortdir?v[f].sortdir="desc":v[f].sortdir="asc":(w=[f],0>g?v[f].sortdir="asc":"asc"==v[f].sortdir?v[f].sortdir="desc":v[f].sortdir="asc"),e=0;e<v.length;e++)v[e]&&v[e].sortable&&(c=n.find("th:nth-child("+(e+1)+")"),d=c.find("span"),a.inArray(e,w)<0?(c.removeClass("slimtable-activeth"),d.removeClass("slimtable-sortasc"),d.removeClass("slimtable-sortdesc"),d.addClass("slimtable-sortboth")):(d.removeClass("slimtable-sortboth"),d.removeClass("slimtable-sort"+("asc"==v[e].sortdir?"desc":"asc")),d.addClass("slimtable-sort"+v[e].sortdir),c.addClass("slimtable-activeth")));w.length>0&&x.sort(function(a,b){var c,d,e,f,g=w.length;for(f=0;g>f;f++)if(c=w[f],d=a[c],e=b[c],!(d==e&&g-1>f))switch("desc"==v[c].sortdir&&(d=b[c],e=a[c]),v[c].strip_html&&(d=i(d),e=i(e)),v[c].rowtype){case 1:return d-e;case 2:case 3:return d=parseFloat(d.replace(",",".")),e=parseFloat(e.replace(",",".")),d-e;default:return d=new String(d.toLowerCase()),e=new String(e.toLowerCase()),d.localeCompare(e)}}),h(),u.sortEndCB&&"function"==typeof u.sortEndCB&&u.sortEndCB.call(this)}var n,o,p,q,r,s,t,u=a.extend({tableData:null,dataUrl:null,itemsPerPage:10,ipp_list:[5,10,20],colSettings:[],text1:"items/page",text2:"Loading...",sortStartCB:null,sortEndCB:null},b),v=[],w=[],x=[];return this.each(function(){return q=0,s=!1,r=u.itemsPerPage,t=document.createElement("div"),n=a(this).find("thead"),o=a(this).find("tbody"),0==n.length||0==o.length?void console.log("Slimtable: thead/tbody missing from table!"):(f(),void((0!=s||c())&&(a(this).addClass("slimtable"),e(),d(a(this)),h())))})}}(jQuery);