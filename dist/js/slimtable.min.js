/*!
 * slimtable ( http://slimtable.mcfish.org/ )
 * 
 * Licensed under MIT license.
 *
 * @version 1.2.4
 * @author Pekka Harjamäki
 */
!function(a){a.fn.slimtable=function(b){function c(){return y.length>0&&w.length!=y[0].length?(console.log("Slimtable: Different number of columns in header and data!"),!1):!0}function d(b){var c,d,e,f,g=document.createElement("select");for(c=document.createElement("div"),a(c).addClass("slimtable-paging-div"),f=0;f<v.ipp_list.length;f++)e=document.createElement("option"),e.value=v.ipp_list[f],e.text=v.ipp_list[f],e.value==v.itemsPerPage&&(e.selected=!0),a(g).append(e);a(g).on("change",m).addClass("slimtable-paging-select"),d=document.createElement("div"),a(d).addClass("slimtable-paging-btnsdiv"),a(c).append(d),q=d,d=document.createElement("div"),a(d).addClass("slimtable-paging-seldiv"),a(d).append(g),a(d).append(v.text1),a(c).append(d),d=document.createElement("div"),a(d).addClass("slimtable-container-div"),a(d).append(c),b.before(d),b.insertBefore(c)}function e(){o.find("th").each(function(b){if(a(this).attr("unselectable","on"),w[b]&&w[b].sortable){var c=document.createElement("span");a(c).attr("unselectable","on").addClass("slimtable-sprites"),"asc"==w[b].sordir?a(c).addClass("slimtable-sortasc"):"desc"==w[b].sordir?a(c).addClass("slimtable-sortdesc"):a(c).addClass("slimtable-sortboth"),a(this).prepend(c).css({cursor:"pointer"}).on("click",n)}else a(this).addClass("slimtable-unsortable")})}function f(){var b,c,d,e,f,i,j=o.find("th");for(w=[],b=0;b<j.length;b++){var k=!0,l=!1,m=-1,n="asc",q=[];for(c=0;c<v.colSettings.length;c++)if(v.colSettings[c].colNumber==b){f=v.colSettings[c],0==f.enableSort&&(k=!1),1==f.stripHtml&&(l=!0),("asc"==f.sortDir||"desc"==f.sortDir)&&(n=f.sortDir),f.rowType>=0&&(m=f.rowType),f.addClasses&&f.addClasses.length>0&&(q=f.addClasses);break}w[b]={sortable:k,classes:q,strip_html:l,sortdir:n,rowtype:m}}v.sortList.length>0&&(x=v.sortList),v.dataUrl&&v.dataUrl.length>2?(t=!0,a.ajax({url:v.dataUrl,dataType:"json"}).done(function(a){y=a,t=!1,h()}).fail(function(a,b){console.log("Slimtable: Ajax error: "+b)})):v.tableData&&v.tableData.length>=0?y=v.tableData:p.find("tr").each(function(){e=[],a(this).find("td").each(function(){for(f={orig:a(this).html(),attrs:[],clean:null},i=a(this).attr("sort-data"),"undefined"!=typeof i&&null!=i&&(f.clean=i),d=0;d<v.keepAttrs.length;d++)i=a(this).attr(v.keepAttrs[d]),"undefined"!=typeof i&&f.attrs.push({attr:v.keepAttrs[d],value:i});e.push(f)}),y.push(e)}),g()}function g(){var b,c,d,e,f=o.find("th");for(b=0;b<f.length;b++)if(-1==w[b].rowtype){for(e=[0,0,0,0,0],c=0;c<y.length;c++)null==y[c][b].clean&&(y[c][b].clean=w[b].strip_html?a(u).html(y[c][b].orig).text():y[c][b].orig,y[c][b].clean=a.trim(y[c][b].clean),y[c][b].clean=y[c][b].clean.toLowerCase()),e[j(y[c][b].clean)]++;for(w[b].rowtype=a.inArray(Math.max.apply(this,e),e),c=0;c<y.length;c++)0==w[b].rowtype&&(y[c][b].clean=new String(y[c][b].clean)),(2==w[b].rowtype||3==w[b].rowtype)&&(y[c][b].clean=parseFloat(y[c][b].clean.replace(",","."))),4==w[b].rowtype&&(d=y[c][b].clean.split(/[.\/-]/),y[c][b].clean=new Date(d[2],d[1],d[0]))}}function h(){var b,c,d,e,f,g,h=parseInt(r)+parseInt(s);for(p.empty(),h=h>y.length?y.length:h,d=Math.ceil(y.length/s),e=r;h>e;e++){for(b=document.createElement("tr"),f=0;f<y[e].length;f++){for(c=document.createElement("td"),a(c).html(y[e][f].orig),g=0;g<y[e][f].attrs.length;g++)a(c).attr(y[e][f].attrs[g].attr,y[e][f].attrs[g].value);for(g=0;g<w[f].classes.length;g++)a(c).addClass(w[f].classes[g]);a(b).append(c)}p.append(b)}for(a(q).empty(),e=0;d>e;e++)b=document.createElement("div"),a(b).addClass("slimtable-page-btn").on("click",l).text(e+1),e*s==r&&a(b).addClass("active"),a(q).append(b)}function i(){var b,c,d;for(b=0;b<w.length;b++)w[b]&&w[b].sortable&&(c=o.find("th:nth-child("+(b+1)+")"),d=c.find("span"),a.inArray(b,x)<0?(c.removeClass("slimtable-activeth"),d.removeClass("slimtable-sortasc"),d.removeClass("slimtable-sortdesc"),d.addClass("slimtable-sortboth")):(d.removeClass("slimtable-sortboth"),d.removeClass("slimtable-sort"+("asc"==w[b].sortdir?"desc":"asc")),d.addClass("slimtable-sort"+w[b].sortdir),c.addClass("slimtable-activeth")))}function j(a){var b=/[^0-9]/g,c=/^[0-9]+([\.,][0-9]+)?$/,d=/^([0-9]+([\.,][0-9]+)?)\s*[%$€£e]?$/,e=/^[0-9]{1,2}[.-\/][0-9]{1,2}[.-\/][0-9]{4}$/;return b.test(a)?c.test(a)?2:d.test(a)?3:e.test(a)?4:0:1}function k(){x.length>0&&y.sort(function(a,b){var c,d,e,f,g,h=x.length;for(f=0;h>f;f++)if(c=x[f],"desc"==w[c].sortdir?(d=b[c].clean,e=a[c].clean):(d=a[c].clean,e=b[c].clean),g=!1,0==w[c].rowtype?0==d.localeCompare(e)&&(g=!0):4==w[c].rowtype?d-e==0&&(g=!0):d==e&&(g=!0),!(g&&h-1>f))return 0==w[c].rowtype?d.localeCompare(e):d-e}),i(),h()}function l(b){var c=parseInt(a(this).text())-1,d=Math.ceil(y.length/s);0>c||c>=d||(r=c*s,h())}function m(a){s=this.value,r=0,h()}function n(b){var c=a(this).index(),d=a.inArray(c,x);b.preventDefault(),v.sortStartCB&&"function"==typeof v.sortStartCB&&v.sortStartCB.call(this),b.shiftKey?0>d?(x.push(c),w[c].sortdir="asc"):"asc"==w[c].sortdir?w[c].sortdir="desc":w[c].sortdir="asc":(x=[c],0>d?w[c].sortdir="asc":"asc"==w[c].sortdir?w[c].sortdir="desc":w[c].sortdir="asc"),k(),v.sortEndCB&&"function"==typeof v.sortEndCB&&v.sortEndCB.call(this)}var o,p,q,r,s,t,u,v=a.extend({tableData:null,dataUrl:null,itemsPerPage:10,ipp_list:[5,10,20],keepAttrs:[],sortList:[],colSettings:[],text1:"items/page",text2:"Loading...",sortStartCB:null,sortEndCB:null},b),w=[],x=[],y=[];return this.each(function(){return r=0,t=!1,s=v.itemsPerPage,u=document.createElement("div"),o=a(this).find("thead"),p=a(this).find("tbody"),0==o.length||0==p.length?void console.log("Slimtable: thead/tbody missing from table!"):(f(),void((0!=t||c())&&(a(this).addClass("slimtable"),e(),d(a(this)),k())))})}}(jQuery);