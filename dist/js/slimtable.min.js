/*!
 * slimtable ( https://slimtable.mcfish.org/ )
 *
 * Licensed under MIT license.
 *
 * @version 2.0.3
 * @author Pekka Harjamäki
 */
(o=>{let e={init1:function(t,s){this.settings=o.extend({tableData:null,dataUrl:null,itemsPerPage:10,ippList:[5,10,20],pagingStart:0,keepAttrs:[],sortList:[],colSettings:[],text1:"items/page",text2:"Loading...",sortStartCB:null,sortEndCB:null},s),this.state={showLoader:!1,cleanerDiv:o("<div></div>"),colSettings:[],tblData:[],sortList:0<this.settings.sortList.length?this.settings.sortList:[],pagingStart:parseInt(this.settings.pagingStart),itemsPerPage:parseInt(this.settings.itemsPerPage),tableHeads:t.find("thead tr th"),tableBody:t.find("tbody")},0===this.state.tableHeads.length||0===this.state.tableBody.length?this.showError("thead/tbody missing from table!"):(this.parseColSettings(),this.readTable(t))},init2:function(t){this.sanityCheck()?(t.addClass("slimtable"),this.addSortIcons(),this.addPaging(t),this.doSorting()):this.showError("Different number of columns in header and data!")},parseColSettings:function(){for(let t=0;t<this.state.tableHeads.length;t++){this.state.colSettings[t]={enableSort:!0,classes:[],stripHtml:!1,sortDir:"asc",rowType:-1,colNumber:t};for(var s of this.settings.colSettings)if(s.colNumber===t){!1===s.enableSort&&(this.state.colSettings[t].enableSort=!1),!0===s.stripHtml&&(this.state.colSettings[t].stripHtml=!0),"asc"!==s.sortDir&&"desc"!==s.sortDir||(this.state.colSettings[t].sortDir=s.sortDir),0<=s.rowType&&(this.state.colSettings[t].rowType=s.rowType),s.addClasses&&0<s.addClasses.length&&(this.state.colSettings[t].classes=s.addClasses);break}}},returnRowType:function(t){return 0===t.length?-1:/[^0-9]/g.test(t)?/^[0-9]+([.,][0-9]+)?$/.test(t)?2:/^([0-9]+([.,][0-9]+)?)\s*[%$€£e]?$/.test(t)?3:/^[0-9]{1,2}[.-/][0-9]{1,2}[.-/][0-9]{4}$/.test(t)?4:0:1},readTable:function(s){let a,e,i,l=this;this.settings.dataUrl&&2<this.settings.dataUrl.length?(this.state.showLoader=!0,o.ajax({url:this.settings.dataUrl,dataType:"json"}).done(function(t){l.processData(t),l.state.showLoader=!1,l.init2(s)}).fail(function(t,s){l.showError("Ajax error: "+s)})):(this.settings.tableData&&0<=this.settings.tableData.length?this.processData(this.settings.tableData):(this.state.tableBody.find("tr").each(function(){e={data:[],attrs:[]};for(var t of l.settings.keepAttrs)void 0!==(i=o(this).attr(t))&&e.attrs.push({attr:t,value:i});o(this).find("td").each(function(){a={orig:o(this).html(),attrs:[],clean:null},null!=(i=o(this).attr("sort-data"))&&(a.clean=i);for(var t of l.settings.keepAttrs)void 0!==(i=o(this).attr(t))&&a.attrs.push({attr:t,value:i});e.data.push(a)}),l.state.tblData.push(e)}),this.processData(null)),this.init2(s))},processData:function(t){let s,a,e,i,l,n;if(null!==t)for(this.state.tblData=[],s=0;s<t.length;s++){for(i={data:[],attrs:[]},a=0;a<t[s].length;a++)i.data.push({orig:t[s][a],attrs:[],clean:null});this.state.tblData.push(i)}for(s=0;s<this.state.tableHeads.length;s++){if(e=[0,0,0,0,0],-1===this.state.colSettings[s].rowType){for(a=0;a<this.state.tblData.length;a++)null===(l=this.state.tblData[a].data[s]).clean?(l=this.state.colSettings[s].stripHtml?this.state.cleanerDiv.html(l.orig).text():l.orig,l=o.trim(l).toLowerCase(),this.state.tblData[a].data[s].clean=l):l=l.clean,0<(n=this.returnRowType(l))&&e[n]++;this.state.colSettings[s].rowType=o.inArray(Math.max.apply(this,e),e)}for(a=0;a<this.state.tblData.length;a++)n=this.state.colSettings[s].rowType,l=this.state.tblData[a].data[s].clean,0===n&&(this.state.tblData[a].data[s].clean=String(l)),2!==n&&3!==n||(this.state.tblData[a].data[s].clean=parseFloat(l.replace(",","."))),4===n&&(l=l.split(/[./-]/),this.state.tblData[a].data[s].clean=new Date(l[2],l[1],l[0]))}},createTableHead:function(){let t,s,a;for(t=0;t<this.state.tableHeads.length;t++)this.state.colSettings[t]&&this.state.colSettings[t].enableSort&&(s=o(this.state.tableHeads[t]),a=s.find("span"),o.inArray(t,this.state.sortList)<0?(s.removeClass("slimtable-activeth"),a.removeClass("slimtable-sortasc").removeClass("slimtable-sortdesc").addClass("slimtable-sortboth")):(s.addClass("slimtable-activeth"),a.removeClass("slimtable-sortboth").removeClass("slimtable-sort"+("asc"===this.state.colSettings[t].sortDir?"desc":"asc")).addClass("slimtable-sort"+this.state.colSettings[t].sortDir)))},createTableBody:function(){var t=Math.ceil(this.state.tblData.length/this.state.itemsPerPage),s=this.state.pagingStart+this.state.itemsPerPage;let a,e,i,l,n,r;for(this.state.tableBody.empty(),s=s>this.state.tblData.length?this.state.tblData.length:s,l=this.state.pagingStart;l<s;l++){for(e=o("<tr></tr>"),r=0;r<this.state.tblData[l].attrs.length;r++)o(e).attr(this.state.tblData[l].attrs[r].attr,this.state.tblData[l].attrs[r].value);for(n=0;n<this.state.tblData[l].data.length;n++){for(a=this.state.tblData[l].data[n],i=o("<td></td>").html(a.orig),r=0;r<a.attrs.length;r++)o(i).attr(a.attrs[r].attr,a.attrs[r].value);for(r=0;r<this.state.colSettings[n].classes.length;r++)o(i).addClass(this.state.colSettings[n].classes[r]);o(e).append(i)}this.state.tableBody.append(e)}for(o(this.state.btnContainer).empty(),l=0;l<t;l++)e=document.createElement("div"),o(e).addClass("slimtable-page-btn").on("click",{self:this},this.handlePageChange).text(l+1),l*this.state.itemsPerPage===this.state.pagingStart&&o(e).addClass("active"),o(this.state.btnContainer).append(e)},addSortIcons:function(){let a=this;this.state.tableHeads.each(function(t){o(this).attr("unselectable","on");var s,t=a.state.colSettings[t];t&&t.enableSort?(s=o("<span></span>").attr("unselectable","on").addClass("slimtable-sprites"),"asc"===t.sortDir?s.addClass("slimtable-sortasc"):"desc"===t.sortDir?s.addClass("slimtable-sortdesc"):s.addClass("slimtable-sortboth"),o(this).prepend(s).css({cursor:"pointer"}).on("click",{self:a},a.handleHeaderClick)):o(this).addClass("slimtable-unsortable")})},addPaging:function(t){let s,a,e;e=o("<select></select>").addClass("slimtable-paging-select").on("change",{self:this},this.handleIppChange);for(let t of this.settings.ippList)a=o("<option></option>").val(t).text(t),t===this.settings.itemsPerPage&&a.attr("selected","selected"),o(e).append(a);a=o("<div></div>").addClass("slimtable-paging-btnsdiv"),this.state.btnContainer=a,s=o("<div></div>").addClass("slimtable-paging-div").append(a),a=o("<div></div>").addClass("slimtable-paging-seldiv").append(e).append(this.settings.text1),o(s).append(a),a=o("<div></div>").addClass("slimtable-container-div").append(s),t.before(a),t.insertBefore(s)},doSorting:function(){let o=this;0<this.state.sortList.length&&this.state.tblData.sort(function(t,s){let a,e,i,l;var n=o.state.sortList.length;for(i=0;i<n;i++){var r=o.state.sortList[i];if(e=("desc"===o.state.colSettings[r].sortDir?(a=s.data[r].clean,t):(a=t.data[r].clean,s)).data[r].clean,l=!1,0===o.state.colSettings[r].rowType?0===a.localeCompare(e)&&(l=!0):4===o.state.colSettings[r].rowType?a-e==0&&(l=!0):a===e&&(l=!0),!(l&&i<n-1))return 0===o.state.colSettings[r].rowType?a.localeCompare(e):a-e}}),this.createTableHead(),this.createTableBody()},handleHeaderClick:function(t){var s=t.data.self,a=o(this).index(),e=o.inArray(a,s.state.sortList);t.preventDefault(),s.settings.sortStartCB&&"function"==typeof s.settings.sortStartCB&&s.settings.sortStartCB.call(s),t.shiftKey?e<0?(s.state.sortList.push(a),s.state.colSettings[a].sortDir="asc"):"asc"===s.state.colSettings[a].sortDir?s.state.colSettings[a].sortDir="desc":s.state.colSettings[a].sortDir="asc":(s.state.sortList=[a],!(e<0)&&"asc"===s.state.colSettings[a].sortDir?s.state.colSettings[a].sortDir="desc":s.state.colSettings[a].sortDir="asc"),s.doSorting(),s.settings.sortEndCB&&"function"==typeof s.settings.sortEndCB&&s.settings.sortEndCB.call(s)},handleIppChange:function(t){t=t.data.self;t.state.itemsPerPage=parseInt(this.value),t.state.pagingStart=0,t.createTableBody()},handlePageChange:function(t){var s=parseInt(o(this).text())-1,t=t.data.self,a=Math.ceil(t.state.tblData.length/t.state.itemsPerPage);0<=s&&s<a&&(t.state.pagingStart=s*t.state.itemsPerPage,t.createTableBody())},sanityCheck:function(){return!(0<this.state.tblData.length&&this.state.colSettings.length!==this.state.tblData[0].data.length)},showError:function(t){console.log("Slimtable: "+t)},getState:function(){var t=this.state;return{colSettings:t.colSettings,sortList:t.sortList,pagingStart:t.pagingStart,itemsPerPage:t.itemsPerPage}}};o.fn.slimtable=function(s){let a="plugin_slimtable";var t;return void 0===s||"object"==typeof s?this.each(function(){var t;o.data(this,a)||((t=Object.create(e)).init1(o(this),s),o.data(this,a,t))}):"string"==typeof s&&"getState"===s?(t=o(this).data(a))?t.getState():{}:void 0}})(jQuery);