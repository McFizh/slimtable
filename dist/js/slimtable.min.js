/*!
 * slimtable ( http://slimtable.mcfish.org/ )
 *
 * Licensed under MIT license.
 *
 * @version 1.2.7
 * @author Pekka Harjamäki
 */!function(a){a.fn.slimtable=function(b){function c(){return!(z.length>0&&x.length!=z[0].data.length)}function d(b){var c,d,e,f;for(f=a("<select></select>").addClass("slimtable-paging-select").on("change",n),e=0;e<w.ipp_list.length;e++)c=w.ipp_list[e],d=a("<option></option>").val(c).text(c),c==w.itemsPerPage&&d.attr("selected","selected"),a(f).append(d);d=document.createElement("div"),a(d).addClass("slimtable-paging-btnsdiv"),r=d,c=a("<div></div>").addClass("slimtable-paging-div").append(d),d=a("<div></div>").addClass("slimtable-paging-seldiv").append(f).append(w.text1),a(c).append(d),d=a("<div></div>").addClass("slimtable-container-div").append(c),b.before(d),b.insertBefore(c)}function e(){var b;p.find("th").each(function(c){if(a(this).attr("unselectable","on"),b=x[c],b&&b.sortable){var d=document.createElement("span");a(d).attr("unselectable","on").addClass("slimtable-sprites"),"asc"==b.sortDir?a(d).addClass("slimtable-sortasc"):"desc"==b.sortDir?a(d).addClass("slimtable-sortdesc"):a(d).addClass("slimtable-sortboth"),a(this).prepend(d).css({cursor:"pointer"}).on("click",o)}else a(this).addClass("slimtable-unsortable")})}function f(a){var b,c,d;for(z=[],b=0;b<a.length;b++){for(d={data:[],attrs:[]},c=0;c<a[b].length;c++)d.data.push({orig:a[b][c],attrs:[],clean:null});z.push(d)}}function g(){var b,d,e,g,i,k,m,n=p.find("th");for(x=[],b=0;b<n.length;b++)for(x[b]={sortable:!0,classes:[],stripHtml:!1,sortDir:"asc",rowType:-1},d=0;d<w.colSettings.length;d++)if(i=w.colSettings[d],i.colNumber==b){i.enableSort===!1&&(x[b].sortable=!1),i.stripHtml===!0&&(x[b].stripHtml=!0),"asc"!=i.sortDir&&"desc"!=i.sortDir||(x[b].sortDir=i.sortDir),i.rowType>=0&&(x[b].rowType=i.rowType),i.addClasses&&i.addClasses.length>0&&(x[b].classes=i.addClasses);break}if(y=w.sortList.length>0?w.sortList:[],w.dataUrl&&w.dataUrl.length>2?(u=!0,a.ajax({url:w.dataUrl,dataType:"json"}).done(function(a){f(a),u=!1,h()}).fail(function(a,b){l("Ajax error: "+b)})):w.tableData&&w.tableData.length>=0?f(w.tableData):q.find("tr").each(function(){for(g={data:[],attrs:[]},b=0;b<w.keepAttrs.length;b++)e=w.keepAttrs[b],k=a(this).attr(e),"undefined"!=typeof k&&g.attrs.push({attr:e,value:k});a(this).find("td").each(function(){for(i={orig:a(this).html(),attrs:[],clean:null},k=a(this).attr("sort-data"),"undefined"!=typeof k&&null!==k&&(i.clean=k),b=0;b<w.keepAttrs.length;b++)e=w.keepAttrs[b],k=a(this).attr(e),"undefined"!=typeof k&&i.attrs.push({attr:e,value:k});g.data.push(i)}),z.push(g)}),c())for(b=0;b<n.length;b++){if(m=[0,0,0,0,0],-1==x[b].rowType){for(d=0;d<z.length;d++)i=z[d].data[b],null===i.clean?(i=x[b].stripHtml?a(v).html(i.orig).text():i.orig,i=a.trim(i).toLowerCase(),z[d].data[b].clean=i):i=i.clean,k=j(i),k>0&&m[k]++;x[b].rowType=a.inArray(Math.max.apply(this,m),m)}for(d=0;d<z.length;d++)k=x[b].rowType,i=z[d].data[b].clean,0===k&&(z[d].data[b].clean=String(i)),2!=k&&3!=k||(z[d].data[b].clean=parseFloat(i.replace(",","."))),4==k&&(i=i.split(/[.\/-]/),z[d].data[b].clean=new Date(i[2],i[1],i[0]))}}function h(){var b,c,d,e,f,g,h=s+t,i=Math.ceil(z.length/t);for(q.empty(),h=h>z.length?z.length:h,e=s;h>e;e++){for(c=a("<tr></tr>"),g=0;g<z[e].attrs.length;g++)a(c).attr(z[e].attrs[g].attr,z[e].attrs[g].value);for(f=0;f<z[e].data.length;f++){for(b=z[e].data[f],d=a("<td></td>").html(b.orig),g=0;g<b.attrs.length;g++)a(d).attr(b.attrs[g].attr,b.attrs[g].value);for(g=0;g<x[f].classes.length;g++)a(d).addClass(x[f].classes[g]);a(c).append(d)}q.append(c)}for(a(r).empty(),e=0;i>e;e++)c=document.createElement("div"),a(c).addClass("slimtable-page-btn").on("click",m).text(e+1),e*t==s&&a(c).addClass("active"),a(r).append(c)}function i(){var b,c,d;for(b=0;b<x.length;b++)x[b]&&x[b].sortable&&(c=p.find("th:nth-child("+(b+1)+")"),d=c.find("span"),a.inArray(b,y)<0?(c.removeClass("slimtable-activeth"),d.removeClass("slimtable-sortasc").removeClass("slimtable-sortdesc").addClass("slimtable-sortboth")):(c.addClass("slimtable-activeth"),d.removeClass("slimtable-sortboth").removeClass("slimtable-sort"+("asc"==x[b].sortDir?"desc":"asc")).addClass("slimtable-sort"+x[b].sortDir)))}function j(a){var b=/[^0-9]/g,c=/^[0-9]+([\.,][0-9]+)?$/,d=/^([0-9]+([\.,][0-9]+)?)\s*[%$€£e]?$/,e=/^[0-9]{1,2}[.-\/][0-9]{1,2}[.-\/][0-9]{4}$/;return 0===a.length?-1:b.test(a)?c.test(a)?2:d.test(a)?3:e.test(a)?4:0:1}function k(){y.length>0&&z.sort(function(a,b){var c,d,e,f,g,h=y.length;for(f=0;h>f;f++)if(c=y[f],"desc"==x[c].sortDir?(d=b.data[c].clean,e=a.data[c].clean):(d=a.data[c].clean,e=b.data[c].clean),g=!1,0===x[c].rowType?0===d.localeCompare(e)&&(g=!0):4==x[c].rowType?d-e===0&&(g=!0):d==e&&(g=!0),!(g&&h-1>f))return 0===x[c].rowType?d.localeCompare(e):d-e}),i(),h()}function l(a){console.log("Slimtable: "+a)}function m(b){var c=parseInt(a(this).text())-1,d=Math.ceil(z.length/t);0>c||c>=d||(s=c*parseInt(t),h())}function n(a){t=parseInt(this.value),s=0,h()}function o(b){var c=a(this).index(),d=a.inArray(c,y);b.preventDefault(),w.sortStartCB&&"function"==typeof w.sortStartCB&&w.sortStartCB.call(this),b.shiftKey?0>d?(y.push(c),x[c].sortDir="asc"):"asc"==x[c].sortDir?x[c].sortDir="desc":x[c].sortDir="asc":(y=[c],0>d?x[c].sortDir="asc":"asc"==x[c].sortDir?x[c].sortDir="desc":x[c].sortDir="asc"),k(),w.sortEndCB&&"function"==typeof w.sortEndCB&&w.sortEndCB.call(this)}var p,q,r,s,t,u,v,w=a.extend({tableData:null,dataUrl:null,itemsPerPage:10,ipp_list:[5,10,20],keepAttrs:[],sortList:[],colSettings:[],text1:"items/page",text2:"Loading...",sortStartCB:null,sortEndCB:null},b),x=[],y=[],z=[];return this.each(function(){return s=0,u=!1,t=parseInt(w.itemsPerPage),v=document.createElement("div"),p=a(this).find("thead"),q=a(this).find("tbody"),0===p.length||0===q.length?void l("thead/tbody missing from table!"):(g(),u!==!1||c()?(a(this).addClass("slimtable"),e(),d(a(this)),void k()):void l("Different number of columns in header and data!"))})}}(jQuery);