/**
 * SlimTable
 * http://slimtable.mcfish.org/
 * 
 * Licensed under MIT license.
 *
 * Date: 12 / 08 / 2013
 * @version 1.1.2
 * @author Pekka Harjamäki
 */(function(e){e.fn.slimtable=function(t){function c(t){var r,i,s=document.createElement("select");r=document.createElement("div"),e(r).addClass("slimtable-paging-div");for(var o=0;o<n.ipp_list.length;o++){var u=document.createElement("option");u.value=n.ipp_list[o],u.text=n.ipp_list[o],u.value==n.itemsPerPage&&(u.selected=!0),e(s).append(u)}e(s).on("change",y),e(s).addClass("slimtable-paging-select"),i=document.createElement("div"),e(i).addClass("slimtable-paging-btnsdiv"),e(r).append(i),a=i,i=document.createElement("div"),e(i).addClass("slimtable-paging-seldiv"),e(i).append(s),e(i).append(n.ipp_text),e(r).append(i),i=document.createElement("div"),e(i).addClass("slimtable-container-div"),e(i).append(r),t.before(i),t.insertBefore(r)}function h(){o.find("th").each(function(t){e(this).attr("unselectable","on");if(r[t]&&r[t].sortable){var n=document.createElement("span");e(n).addClass("slimtable-sprites"),e(n).attr("unselectable","on"),r[t].sordir=="asc"?e(n).addClass("slimtable-sortasc"):r[t].sordir=="desc"?e(n).addClass("slimtable-sortdesc"):e(n).addClass("slimtable-sortboth"),e(this).prepend(n).css({cursor:"pointer"}).on("click",b)}})}function p(){var t=o.find("th"),i,a;r=new Array;for(i=0;i<t.length;i++){var f=!0,l=!1,c=-1,h=[];for(a=0;a<n.colSettings.length;a++)if(n.colSettings[a].colNumber==i){n.colSettings[a].enableSort==0&&(f=!1),n.colSettings[a].stripHtml==1&&(l=!0),n.colSettings[a].rowType>=0&&(c=n.colSettings[a].rowType),n.colSettings[a].addClasses&&n.colSettings[a].addClasses.length>0&&(h=n.colSettings[a].addClasses);break}r[i]={sortable:f,classes:h,strip_html:l,sortdir:"asc",rowtype:c}}!n.tableData||n.tableData.length<=0?u.find("tr").each(function(){var t=new Array;e(this).find("td").each(function(){t.push(e(this).html())}),s.push(t)}):s=n.tableData;for(i=0;i<t.length;i++)if(r[i].rowtype==-1){var p=[0,0,0,0],d;for(a=0;a<s.length;a++)d=m(s[a][i],r[i].strip_html),p[d]++;r[i].rowtype=e.inArray(Math.max.apply(this,p),p)}}function d(){var t=parseInt(f)+parseInt(l),n,i,o,c,h,p;u.empty(),t=t>s.length?s.length:t;for(c=f;c<t;c++){n=document.createElement("tr");for(h=0;h<s[c].length;h++){i=document.createElement("td"),e(i).html(s[c][h]);for(p=0;p<r[h].classes.length;p++)e(i).addClass(r[h].classes[p]);e(n).append(i)}u.append(n)}e(a).empty(),o=Math.ceil(s.length/l);for(c=0;c<o;c++)n=document.createElement("div"),e(n).addClass("slimtable-page-btn"),e(n).on("click",g),e(n).text(c+1),c*l==f&&e(n).addClass("active"),e(a).append(n)}function v(t){var n=document.createElement("div");return e(n).html(t),e(n).text()}function m(e,t){var n=/[^0-9]/g,r=/[^0-9,\.]/g,i=/^([0-9]+([\.,][0-9]+)?)\s*[%$€£e]?$/;return t&&(e=v(e)),n.test(e)?r.test(e)?i.test(e)?3:0:2:1}function g(t){var n=parseInt(e(this).text())-1,r=Math.ceil(s.length/l);if(n<0||n>=r)return;f=n*l,d()}function y(e){var t=this.value;l=this.value,f=0,d()}function b(t){var u=e(this).index(),a,f,l=e.inArray(u,i);t.preventDefault(),n.sortStartCB&&typeof n.sortStartCB=="function"&&n.sortStartCB.call(this),t.shiftKey?l<0?(i.push(u),r[u].sortdir="asc"):r[u].sortdir=="asc"?r[u].sortdir="desc":r[u].sortdir="asc":(i=[u],l<0?r[u].sortdir="asc":r[u].sortdir=="asc"?r[u].sortdir="desc":r[u].sortdir="asc");for(var c=0;c<r.length;c++){if(!r[c]||!r[c].sortable)continue;a=o.find("th:nth-child("+(c+1)+")"),f=a.find("span"),e.inArray(c,i)<0?(a.removeClass("slimtable-activeth"),f.removeClass("slimtable-sortasc"),f.removeClass("slimtable-sortdesc"),f.addClass("slimtable-sortboth")):(f.removeClass("slimtable-sortboth"),f.removeClass("slimtable-sort"+(r[c].sortdir=="asc"?"desc":"asc")),f.addClass("slimtable-sort"+r[c].sortdir),a.addClass("slimtable-activeth"))}i.length>0&&s.sort(function(e,t){var n,s,o;for(var u=0;u<i.length;u++){n=i[u];if(e[n]==t[n]&&u<i.length-1)continue;r[n].sortdir=="desc"?(s=t[n],o=e[n]):(s=e[n],o=t[n]),r[n].strip_html&&(s=v(s),o=v(o));switch(r[n].rowtype){case 1:return s-o;case 2:case 3:return s=parseFloat(s.replace(",",".")),o=parseFloat(o.replace(",",".")),s-o;default:return s=new String(s.toLowerCase()),o=new String(o.toLowerCase()),s.localeCompare(o)}}}),d(),n.sortEndCB&&typeof n.sortEndCB=="function"&&n.sortEndCB.call(this)}var n=e.extend({tableData:null,itemsPerPage:10,ipp_list:[5,10,20],colSettings:[],ipp_text:"items/page",sortStartCB:null,sortEndCB:null},t),r=[],i=[],s=[],o,u,a,f,l;return this.each(function(){f=0,l=n.itemsPerPage,o=e(this).find("thead"),u=e(this).find("tbody");if(o.length==0||u.length==0){console.log("Slimtable: thead/tbody missing from table!");return}p();if(s.length>0&&r.length!=s[0].length){console.log("Slimtable: Different number of columns in header and data!");return}h(),e(this).addClass("slimtable"),c(e(this)),d()})}})(jQuery);