/**
 * SlimTable
 * http://slimtable.mcfish.org/
 * 
 * Licensed under MIT license.
 *
 * Date: 18 / 08 / 2013
 * @version 1.1.3
 * @author Pekka Harjamäki
 */(function(e){e.fn.slimtable=function(t){function p(){return s.length>0&&r.length!=s[0].length?(console.log("Slimtable: Different number of columns in header and data!"),!1):!0}function d(t){var r,i,s,o,u=document.createElement("select");r=document.createElement("div"),e(r).addClass("slimtable-paging-div");for(o=0;o<n.ipp_list.length;o++)s=document.createElement("option"),s.value=n.ipp_list[o],s.text=n.ipp_list[o],s.value==n.itemsPerPage&&(s.selected=!0),e(u).append(s);e(u).on("change",S).addClass("slimtable-paging-select"),i=document.createElement("div"),e(i).addClass("slimtable-paging-btnsdiv"),e(r).append(i),a=i,i=document.createElement("div"),e(i).addClass("slimtable-paging-seldiv"),e(i).append(u),e(i).append(n.text1),e(r).append(i),i=document.createElement("div"),e(i).addClass("slimtable-container-div"),e(i).append(r),t.before(i),t.insertBefore(r)}function v(){o.find("th").each(function(t){e(this).attr("unselectable","on");if(r[t]&&r[t].sortable){var n=document.createElement("span");e(n).addClass("slimtable-sprites"),e(n).attr("unselectable","on"),r[t].sordir=="asc"?e(n).addClass("slimtable-sortasc"):r[t].sordir=="desc"?e(n).addClass("slimtable-sortdesc"):e(n).addClass("slimtable-sortboth"),e(this).prepend(n).css({cursor:"pointer"}).on("click",x)}})}function m(){var t=o.find("th"),i,a;r=new Array;for(i=0;i<t.length;i++){var f=!0,l=!1,h=-1,p=[];for(a=0;a<n.colSettings.length;a++)if(n.colSettings[a].colNumber==i){n.colSettings[a].enableSort==0&&(f=!1),n.colSettings[a].stripHtml==1&&(l=!0),n.colSettings[a].rowType>=0&&(h=n.colSettings[a].rowType),n.colSettings[a].addClasses&&n.colSettings[a].addClasses.length>0&&(p=n.colSettings[a].addClasses);break}r[i]={sortable:f,classes:p,strip_html:l,sortdir:"asc",rowtype:h}}n.dataUrl&&n.dataUrl.length>2?(c=!0,e.ajax({url:n.dataUrl,dataType:"json"}).done(function(e){s=e,c=!1,g(),y()}).fail(function(e,t){console.log("Slimtable: Ajax error: "+t)})):n.tableData&&n.tableData.length>=0?(s=n.tableData,g()):(u.find("tr").each(function(){var t=new Array;e(this).find("td").each(function(){t.push(e(this).html())}),s.push(t)}),g())}function g(){var t=o.find("th");for(var n=0;n<t.length;n++)if(r[n].rowtype==-1){var i=[0,0,0,0],u;for(l2=0;l2<s.length;l2++)u=w(s[l2][n],r[n].strip_html),i[u]++;r[n].rowtype=e.inArray(Math.max.apply(this,i),i)}}function y(){var t=parseInt(f)+parseInt(l),n,i,o,c,h,p;u.empty(),t=t>s.length?s.length:t,o=Math.ceil(s.length/l);for(c=f;c<t;c++){n=document.createElement("tr");for(h=0;h<s[c].length;h++){i=document.createElement("td"),e(i).html(s[c][h]);for(p=0;p<r[h].classes.length;p++)e(i).addClass(r[h].classes[p]);e(n).append(i)}u.append(n)}e(a).empty();for(c=0;c<o;c++)n=document.createElement("div"),e(n).addClass("slimtable-page-btn").on("click",E).text(c+1),c*l==f&&e(n).addClass("active"),e(a).append(n)}function b(t){return e(h).html(t).text()}function w(e,t){var n=/[^0-9]/g,r=/[^0-9,\.]/g,i=/^([0-9]+([\.,][0-9]+)?)\s*[%$€£e]?$/;return t&&(e=b(e)),n.test(e)?r.test(e)?i.test(e)?3:0:2:1}function E(t){var n=parseInt(e(this).text())-1,r=Math.ceil(s.length/l);if(n<0||n>=r)return;f=n*l,y()}function S(e){var t=this.value;l=this.value,f=0,y()}function x(t){var u=e(this).index(),a,f,l,c=e.inArray(u,i);t.preventDefault(),n.sortStartCB&&typeof n.sortStartCB=="function"&&n.sortStartCB.call(this),t.shiftKey?c<0?(i.push(u),r[u].sortdir="asc"):r[u].sortdir=="asc"?r[u].sortdir="desc":r[u].sortdir="asc":(i=[u],c<0?r[u].sortdir="asc":r[u].sortdir=="asc"?r[u].sortdir="desc":r[u].sortdir="asc");for(l=0;l<r.length;l++){if(!r[l]||!r[l].sortable)continue;a=o.find("th:nth-child("+(l+1)+")"),f=a.find("span"),e.inArray(l,i)<0?(a.removeClass("slimtable-activeth"),f.removeClass("slimtable-sortasc"),f.removeClass("slimtable-sortdesc"),f.addClass("slimtable-sortboth")):(f.removeClass("slimtable-sortboth"),f.removeClass("slimtable-sort"+(r[l].sortdir=="asc"?"desc":"asc")),f.addClass("slimtable-sort"+r[l].sortdir),a.addClass("slimtable-activeth"))}i.length>0&&s.sort(function(e,t){var n,s,o,u,a=i.length;for(u=0;u<a;u++){n=i[u],s=e[n],o=t[n];if(s==o&&u<a-1)continue;r[n].sortdir=="desc"&&(s=t[n],o=e[n]),r[n].strip_html&&(s=b(s),o=b(o));switch(r[n].rowtype){case 1:return s-o;case 2:case 3:return s=parseFloat(s.replace(",",".")),o=parseFloat(o.replace(",",".")),s-o;default:return s=new String(s.toLowerCase()),o=new String(o.toLowerCase()),s.localeCompare(o)}}}),y(),n.sortEndCB&&typeof n.sortEndCB=="function"&&n.sortEndCB.call(this)}var n=e.extend({tableData:null,dataUrl:null,itemsPerPage:10,ipp_list:[5,10,20],colSettings:[],text1:"items/page",text2:"Loading...",sortStartCB:null,sortEndCB:null},t),r=[],i=[],s=[],o,u,a,f,l,c,h;return this.each(function(){f=0,c=!1,l=n.itemsPerPage,h=document.createElement("div"),o=e(this).find("thead"),u=e(this).find("tbody");if(o.length==0||u.length==0){console.log("Slimtable: thead/tbody missing from table!");return}m();if(c==0&&!p())return;e(this).addClass("slimtable"),v(),d(e(this)),y()})}})(jQuery);
